<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<style>
  .button-containerZ {
    display: flex;
    justify-content: space-between; /* 각 버튼을 컨테이너 양 끝에 배치 */
    width: 100%; /* 부모 컨테이너의 너비를 100%로 설정하여 가로로 전체 영역을 차지하도록 함 */
  }

  .button-containerZ button {
    width: calc(33.33% - 10px); /* 버튼 너비를 컨테이너의 1/3로 설정하고 각 버튼 사이에 여백을 추가 */
    margin-top: 100px;
    height: 250px;
  }

  .tier-btnZ {
    /* 버튼에 대한 기본 스타일 */
    padding: 10px 20px;
    border: none;
    background-color: #232f3e;
    color: white;
    font-size: 20px;
    cursor: pointer;
    position: relative;

  }

  .holeZ {
    position: absolute;
    top: 10%;
    left: 10%;
    width: 10%;
    height: 10%;
    background-color: transparent;
    cursor: pointer;
  }

</style>

<body>
<!--결제API-->
<script src="https://cdn.iamport.kr/v1/iamport.js"></script>





<!-- content -->
<th:block th:replace="~{./include/homelayout :: homeContent( ~{ :: .main-wrap } )}">

  <div class="main-wrap">
    <div class="pic-line-wrap">
      <div class="pic-text-wrap">
        <div class="p-wrap-m">
          <P><span>손끝</span>에서 시작하는</P>
        </div>
        <h2>ONE STOP 학습 솔루션</h2>
        <h4>학습 부터 관리까지 Groups로 간편하게!</h4>


        <h2 >[[${membervo.korn_flnm}]] 님의 현재 구독 티어는 [[${membervo.tier}]] 입니다</h2>

        <div class="button-containerZ" >
<!--          <button class="tier-btnZ" onclick="requestPay('PRETIER', 10)">PRETIER 결제하기</button>-->
<!--          <button class="tier-btnZ" onclick="requestPay('BASICTIER', 20)">BASICTIER 결제하기<hr>금액:10원</button>-->
<!--          <button class="tier-btnZ" onclick="requestPay('MASTERTIER', 30)">MASTERTIER 결제하기<hr>금액:20원</button>-->
          <button class="tier-btnZ" onclick="requestPayfor('FREETIER', 0)" data-tier="FREETIER" >
              FREETIER
            <div class="holeZ"><input type="checkbox" th:checked="${membervo.tier}== 'FREETIER'"></div>
          </button>

          <button class="tier-btnZ" onclick="requestPayfor('BASICTIER', 10)" data-tier="BASICTIER">
            <div class="holeZ"><input type="checkbox" th:checked="${membervo.tier}== 'BASICTIER'"></div>
            BASICTIER
            <hr>금액:10원
          </button>

          <button class="tier-btnZ" onclick="requestPayfor('MASTERTIER', 20)" data-tier="MASTERTIER">
            <div class="holeZ"><input type="checkbox" th:checked="${membervo.tier}== 'MASTERTIER'"></div>
            MASTERTIER
            <hr>금액:20원
          </button>
        </div>
      </div>
      <div class="paybuttonZ"> <!--결제 방법 카카오페이-->
        <button onclick="requestPayKakao()" style="padding: 10px 20px; margin-top: 10%; font-size: 15px;">
            카카오페이<br>결제하기</button>
        <button onclick="requestPayToss()" style="padding: 10px 20px; margin-top: 10%; font-size: 15px;">
              토스페이먼츠로<br>결제하기</button>
      </div>

    </div>


  </div>


</th:block>
<!--결제를 위한 스크립트-->
<script>
  IMP.init("imp04137027");
  let tierZ = "[[${membervo.tier}]]"
  let amountZ = 0 //결제 금액
  let using_term = 3 //구독 개월수
  let buyer_id = "[[${membervo.login_id}]]"; //구매자 아이디
  let buyer_email = "[[${membervo.adm_eml_addr}]]"; //구매자 이메일
  let buyer_address = "[[${membervo.lotno_daddr}]]"; //구매자 주소
  let randomNumber = Math.floor(Math.random() * 90000) + 10000;
  let payment_time = new Date().toLocaleString(); //결제 시간
  function requestPayfor(tier, price){ //price를 (결제 티어 이름 * 구독 기간)
    tierZ = tier;
    amountZ = price * using_term;

    console.log("buyer_id 출력:::: " + buyer_id);
    console.log("buyer_email 출력:::: " + buyer_email);
    console.log("결제 금액 티어 * 개월 수== " + amountZ);
    console.log("결제시간==" + payment_time);
  }
  function requestPayKakao() {
      // 결제창 호출
      IMP.request_pay(
          {
              pg: "kakaopay",
              pay_method: "card",
              merchant_uid: "test_luw8br" + buyer_id + randomNumber, //숫자 바꾸자
              name: tierZ,
              amount: amountZ,
              buyer_name: buyer_id,
              buyer_email: buyer_email,
              buyer_addr: buyer_address,

          },
          rsp => {
              if (rsp.success) {
                  console.log("rsp.success 조건 만족!!!!");

                  // POST 요청 보내기
                  $.ajax({
                      url: "/paymentpageZ/topaymentpageZ",
                      type: "POST",
                      contentType: "application/json",
                      data: JSON.stringify({
                          name : rsp.name,
                          imp_uid: rsp.imp_uid,
                          merchant_uid: rsp.merchant_uid,
                          buyer_name: rsp.buyer_name,
                          buyer_email : rsp.buyer_email,
                          buyer_addr : rsp.buyer_addr,
                          using_term: using_term,
                          amount: amountZ
                      }),
                      success: function (data) {
                          console.log("요청 성공!");
                          window.location.href = '/main'; //결제 완료시 어디로 갈것인가
                      },
                      error: function (xhr, status, error) {
                          console.error("요청 실패:", error);
                      }
                  });
              } else {
                  alert(`결제에 실패하였습니다. 에러 내용: ${rsp.error_msg}`);
              }
          }
      );
  }

  function requestPayToss() {
      IMP.request_pay({
          pg: "tosspayments",
          pay_method: "card",
          merchant_uid: "test_luw8br58",
          name: tierZ,
          amount: amountZ,
          buyer_tel: "010-2679-7140",
      });
  }


</script>
<!--결제를 위한 스크립트-->



<!-- 버튼의 클릭 표시를 위해 만들어놓음 -현준 -->
<script>
  const checkboxes = document.querySelectorAll('.tier-btnZ input[type="checkbox"]');

  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      if (this.checked) {
        checkboxes.forEach(cb => {
          if (cb !== this) {
            cb.checked = false;
          }
        });
      }
    });
  });
</script>
<!-- -->

</body>
</html>